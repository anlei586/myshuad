<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="./css/mui.min.css">
		<!--App自定义的css-->
		<link rel="stylesheet" type="text/css" href="./css/app.css"/>
		<style>
			.title{
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
			
			.oa-contact-cell.mui-table .mui-table-cell {
				padding: 11px 0;
				vertical-align: middle;
			}
			
			.oa-contact-cell {
				position: relative;
				margin: -11px 0;
			}
	
			.oa-contact-avatar {
				width: 75px;
			}
			.oa-contact-avatar img {
				border-radius: 50%;
			}
			.oa-contact-content {
				width: 100%;
			}
			.oa-contact-name {
				margin-right: 20px;
			}
			.oa-contact-name, oa-contact-position {
				float: left;
			}
			
			.vuefill {
			}
			
		</style>
	</head>

	<body>	
		<nav class="vuefill mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" href="#tabbar-with-chat" @tap="onTabClick(event)">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">{{data.mission}}</span>
			</a>
			<a class="mui-tab-item " href="#tabbar-with-map" @tap="onTabClick(event)">
				<span class="mui-icon mui-icon-gear"></span>
				<span class="mui-tab-label">{{data.me}}</span>
			</a>
		</nav>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">	
			<div class="mui-scroll">	
				<div id="tabbar-with-chat" class="mui-control-content mui-active">
					<div class="mui-card" style="margin: 0px; box-shadow: 0 1px 0px rgba(0,0,0,.1);">
						<div class="mui-card-header mui-card-media" style="height:20vw;background-image:url(./images/mkmy1.jpg)"></div>
						<div class="mui-card-content">
							<div class="mui-card-content-inner" v-html="tab_menu.me.lab.mission_note">{{tab_menu.me.lab.mission_note}}</div>
						</div>
					</div>
					<ul class="mui-table-view mui-table-view-chevron" style="margin-top: 8px;">
						<li class="mui-table-view-cell mui-media" v-for="item in mission_items">
							<a class="mui-navigate-right" href="javascript:;" :data-item="item.link" data-name="ahref">
								<img class="mui-media-object mui-pull-left" :src="item.img">
								<div class="mui-media-body">
									{{item.title}}
									<p class='mui-ellipsis'>{{item.link}}</p>
								</div>
							</a>
						</li>
					</ul>
				</div>
				
				<div id="tabbar-with-map" class="mui-control-content ">
					<ul class="mui-table-view " style="padding-top: 36px; padding-bottom: 10px;">
						<li class="mui-table-view-cell">
							<div class="mui-slider-cell">
								<div class="oa-contact-cell mui-table">
									<div class="oa-contact-avatar mui-table-cell">
										<img src="./images/header.gif" />
									</div>
									<div class="oa-contact-content mui-table-cell">
										<div class="mui-clearfix">
											<h4 class="oa-contact-name">{{tab_menu.me.lab.user_email}}</h4>
										</div>
										<p class="oa-contact-email mui-h6">
											{{sv.me.user_email}}
										</p>
									</div>
								</div>
							</div>
						</li>
					</ul>
					<ul class="mui-table-view mui-grid-view mui-grid-9" style=" border-top: none; border-left: none; border-bottom: none; background-color: #ffffff; ">
						<li class="mui-table-view-cell mui-media mui-col-xs-6 ">
							<span class="mui-media-body" style="color: red;">{{sv.me.total_commission}}</span>
							<span class="mui-media-body">{{tab_menu.me.lab.commission}}</span>
						</li>
						<li class="mui-table-view-cell mui-media mui-col-xs-6 ">
							<span class="mui-media-body" style="color: red;">{{sv.me.total_principal}}</span>
							<span class="mui-media-body">{{tab_menu.me.lab.principal}}</span>
						</li>
					</ul>
					<div class="mui-card">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									{{tab_menu.me.lab.public_notice}}
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									{{tab_menu.me.lab.capital_details}}
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									{{tab_menu.me.lab.binding_paypal}}
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									{{tab_menu.me.lab.draw_money}}
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									{{tab_menu.me.lab.share_make_money}}
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									{{tab_menu.me.lab.help}}
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									{{tab_menu.me.lab.my_business_partner}}
								</a>
							</li>
						</ul>
					</div>
					<div class="mui-card">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell" >
								<a style="text-align: center;color: #FF3B30;">
									{{tab_menu.me.lab.logout}}
								</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="./js/mui.min.js"></script>
	<script src="./js/vue.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="./js/lang_cn.js"></script>
	<script>
		//填充tab栏
		new Vue({
			el: '.vuefill',
			data: {
				data:lang_var.tab_menu_lab
			}
		});
		
		var mission_vue;
		var me_vue;
		
		
		function pulldownRefresh() {
			
			mui.ajax("http://127.0.0.1/test.php",
			{success:function(rsp) {
				mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
				mui('#pullrefresh').pullRefresh().endPullupToRefresh();
				//测试数据-我的
				var sv = {
					me:{
						user_email:"13321@13"
						,total_commission:(22.86+Math.random()*1).toFixed(2)
						,total_principal:831.56
					}
				};
				//测试数据-任务
				var mission_items = [
					{
						img:"./images/cbd.jpg",
						title:"这是测试商品1",
						link:"https://m.baidu.com/?1",
					},
					{
						img:"./images/cbd.jpg",
						title:"这是测试商品2",
						link:"https://m.baidu.com/?2",
					},
				];
				//填充-任务列表
				if(!mission_vue){
					mission_vue = new Vue({
						el: '#tabbar-with-chat',
						data: {
							tab_menu:lang_var.tab_menu,
							mission_items:mission_items
						}
					});
				}else{
					mission_vue.mission_items=mission_items;
				}
				//填充-我的数据
				if(!me_vue){
					me_vue = new Vue({
						el: '#tabbar-with-map',
						data: {
							tab_menu:lang_var.tab_menu,
							sv:sv
						}
					});
				}else{
					me_vue.sv = sv;
				}
			},
			});
			
		};
		pulldownRefresh();
		
		mui.init({
			//swipeBack:true ,//启用右滑关闭功能
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					style: 'circle',
					offset: '0px',
					auto: true,
					contentrefresh: "",//正在刷新
					contentdown : "",//下拉可以刷新
					contentover : " ",//释放立即刷新
					callback: pulldownRefresh
				}
			}
		});
		//切换标签时复位滚动条到最顶
		function onTabClick(event){
			var scroller = mui("#pullrefresh").scroll();
			scroller.scrollTo(0,0,0);
		}
		//任务列表点击
		mui("#pullrefresh").on('tap', 'li', function (event) {
			var ahref = event.target.getAttribute("data-name");
			var adata = event.target.getAttribute("data-item");
			if(!ahref){
				ahref = event.target.parentElement.getAttribute("data-name");
				adata = event.target.parentElement.getAttribute("data-item");
				if(!ahref){
					ahref = event.target.parentElement.parentElement.getAttribute("data-name");
					adata = event.target.parentElement.parentElement.getAttribute("data-item");
					if(!ahref){
						ahref = event.target.parentElement.parentElement.parentElement.getAttribute("data-name");
						adata = event.target.parentElement.parentElement.parentElement.getAttribute("data-item");
					}
				}
			}
		    //this.click();
			console.log(adata);
			
			mui.confirm(lang_var.code_lab.OPEN_LINK, lang_var.code_lab.TIP, [lang_var.code_lab.NO, lang_var.code_lab.YES], function(e) {
				if (e.index == 1) {
					window.open(adata);
				} else {
					
				}
			})
			
		});
	</script>
</html>